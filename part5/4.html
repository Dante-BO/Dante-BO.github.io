
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Deep-Packet · DanteSU's House</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="DanteSU">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-footer-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="5.html" />
    
    
    <link rel="prev" href="3.html" />
    

    
        <link rel="shortcut icon" href='../source/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../source/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../source/images/favicon.ico'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../source/images/favicon.ico">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../source/images/favicon.ico">
        
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://dante-su.github.io/" target="_blank" class="custom-link">但丁世界（在建）</a>
        </li>
    
        
        <li>
            <a href="https://github.com/hyffun" target="_blank" class="custom-link">猪猪之家</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../part1/">
            
                <a href="../part1/">
            
                    
                    服务器使用
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../part1/1.html">
            
                <a href="../part1/1.html">
            
                    
                    Anaconda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../part1/2.html">
            
                <a href="../part1/2.html">
            
                    
                    Terminal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../part1/3.html">
            
                <a href="../part1/3.html">
            
                    
                    Pytorch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../part1/4.html">
            
                <a href="../part1/4.html">
            
                    
                    Others
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../part2/">
            
                <a href="../part2/">
            
                    
                    Gitbook
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../part2/1.html">
            
                <a href="../part2/1.html">
            
                    
                    安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../part2/2.html">
            
                <a href="../part2/2.html">
            
                    
                    基本使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../part2/3.html">
            
                <a href="../part2/3.html">
            
                    
                    部署到Github
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../part2/4.html">
            
                <a href="../part2/4.html">
            
                    
                    Markdown使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../part2/5.html">
            
                <a href="../part2/5.html">
            
                    
                    相关链接
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../part3/">
            
                <a href="../part3/">
            
                    
                    图像处理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../part3/1.html">
            
                <a href="../part3/1.html">
            
                    
                    图像缩放
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../part3/2.html">
            
                <a href="../part3/2.html">
            
                    
                    图像修改格式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../part4/">
            
                <a href="../part4/">
            
                    
                    姿态迁移
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                    流量分类
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="1.html">
            
                <a href="1.html">
            
                    
                    相关论文
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="2.html">
            
                <a href="2.html">
            
                    
                    开题报告
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="3.html">
            
                <a href="3.html">
            
                    
                    数据集
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.4" data-path="4.html">
            
                <a href="4.html">
            
                    
                    Deep-Packet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="5.html">
            
                <a href="5.html">
            
                    
                    supplement of DP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../part6/">
            
                <a href="../part6/">
            
                    
                    常用链接
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../part6/1.html">
            
                <a href="../part6/1.html">
            
                    
                    常用网站官网
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../part6/2.html">
            
                <a href="../part6/2.html">
            
                    
                    它山之 玉
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../part6/3.html">
            
                <a href="../part6/3.html">
            
                    
                    bug经验集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../part6/4.html">
            
                <a href="../part6/4.html">
            
                    
                    岗位资源
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Deep-Packet</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#deep-packet"><b></b>Deep-Packet</a></li><ul><li><span class="title-icon "></span><a href="#blog-link"><b></b>Blog Link</a></li><li><span class="title-icon "></span><a href="#structure"><b></b>Structure</a></li><li><span class="title-icon "></span><a href="#files"><b></b>files</a></li><ul><li><span class="title-icon "></span><a href="#fundingyml"><b></b>FUNDING.yml</a></li><li><span class="title-icon "></span><a href="#initpy"><b></b>init.py</a></li><li><span class="title-icon "></span><a href="#datasetpy"><b></b>dataset.py</a></li><li><span class="title-icon "></span><a href="#metricspy"><b></b>metrics.py</a></li><li><span class="title-icon "></span><a href="#modelpy"><b></b>model.py</a></li><li><span class="title-icon "></span><a href="#utilspy"><b></b>utils.py</a></li><li><span class="title-icon "></span><a href="#gitignore"><b></b>.gitignore</a></li><li><span class="title-icon "></span><a href="#createtraintestsetpy"><b></b>create_train_test_set.py</a></li><li><span class="title-icon "></span><a href="#envlinuxcpuyaml"><b></b>env_linux_cpu.yaml</a></li><li><span class="title-icon "></span><a href="#preprocessingpy"><b></b>preprocessing.py</a></li><li><span class="title-icon "></span><a href="#traincnnpy"><b></b>train_cnn.py</a></li><li><span class="title-icon "></span><a href="#utilspy_1"><b></b>utils.py</a></li></ul></ul></ul></div><a href="#deep-packet" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="deep-packet"><a name="deep-packet" class="anchor-navigation-ex-anchor" href="#deep-packet"><i class="fa fa-link" aria-hidden="true"></i></a><a name="deep-packet" class="plugin-anchor" href="#deep-packet"><i class="fa fa-link" aria-hidden="true"></i></a>Deep-Packet</h1>
<h2 id="blog-link"><a name="blog-link" class="anchor-navigation-ex-anchor" href="#blog-link"><i class="fa fa-link" aria-hidden="true"></i></a><a name="blog-link" class="plugin-anchor" href="#blog-link"><i class="fa fa-link" aria-hidden="true"></i></a>Blog Link</h2>
<p><a href="https://blog.munhou.com/2020/04/05/Pytorch-Implementation-of-Deep-Packet-A-Novel-Approach-For-Encrypted-Tra%EF%AC%83c-Classi%EF%AC%81cation-Using-Deep-Learning/" target="_blank">https://blog.munhou.com/2020/04/05/Pytorch-Implementation-of-Deep-Packet-A-Novel-Approach-For-Encrypted-Tra%EF%AC%83c-Classi%EF%AC%81cation-Using-Deep-Learning/</a></p>
<h2 id="structure"><a name="structure" class="anchor-navigation-ex-anchor" href="#structure"><i class="fa fa-link" aria-hidden="true"></i></a><a name="structure" class="plugin-anchor" href="#structure"><i class="fa fa-link" aria-hidden="true"></i></a>Structure</h2>
<ul>
<li><a href="#FUNDING.yml">.github</a><ul>
<li><a href="#FUNDING.yml">FUNDING.yml</a></li>
</ul>
</li>
<li><a href="">ml</a><ul>
<li><a href="#__init__.py"><strong>init</strong>.py</a></li>
<li><a href="#dataset.py">dataset.py</a></li>
<li><a href="#metrics.py">metrics.py</a></li>
<li><a href="#model.py">model.py</a></li>
<li><a href="#mlutils.py">utils.py</a></li>
</ul>
</li>
<li><a href="#.gitignore">.gitignore</a></li>
<li><a href="#create_train_test_set.py">create_train_test_set.py</a></li>
<li><a href="#env_linux_cpu.yaml">env_linux_cpu.yaml</a></li>
<li><a href="#preprocessing.py">preprocessing.py</a></li>
<li><a href="5.html">README.md</a></li>
<li><a href="#train_cnn.py">train_cnn.py</a></li>
<li><a href="#utils.py">utils.py</a></li>
</ul>
<h2 id="files"><a name="files" class="anchor-navigation-ex-anchor" href="#files"><i class="fa fa-link" aria-hidden="true"></i></a><a name="files" class="plugin-anchor" href="#files"><i class="fa fa-link" aria-hidden="true"></i></a>files</h2>
<p><span id="FUNDING.yml"></span></p>
<h3 id="fundingyml"><a name="fundingyml" class="anchor-navigation-ex-anchor" href="#fundingyml"><i class="fa fa-link" aria-hidden="true"></i></a><a name="fundingyml" class="plugin-anchor" href="#fundingyml"><i class="fa fa-link" aria-hidden="true"></i></a>FUNDING.yml</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-yml"><span class="hljs-comment"># These are supported funding model platforms</span>

<span class="hljs-attr">github:</span> <span class="hljs-comment"># Replace with up to 4 GitHub Sponsors-enabled usernames e.g., [user1, user2]</span>
<span class="hljs-attr">patreon:</span> <span class="hljs-comment"># Replace with a single Patreon username</span>
<span class="hljs-attr">open_collective:</span> <span class="hljs-comment"># Replace with a single Open Collective username</span>
<span class="hljs-attr">ko_fi:</span> <span class="hljs-comment"># Replace with a single Ko-fi username</span>
<span class="hljs-attr">tidelift:</span> <span class="hljs-comment"># Replace with a single Tidelift platform-name/package-name e.g., npm/babel</span>
<span class="hljs-attr">community_bridge:</span> <span class="hljs-comment"># Replace with a single Community Bridge project-name e.g., cloud-foundry</span>
<span class="hljs-attr">liberapay:</span> <span class="hljs-comment"># Replace with a single Liberapay username</span>
<span class="hljs-attr">issuehunt:</span> <span class="hljs-comment"># Replace with a single IssueHunt username</span>
<span class="hljs-attr">otechie:</span> <span class="hljs-comment"># Replace with a single Otechie username</span>
<span class="hljs-attr">custom:</span> [<span class="hljs-string">&apos;paypal.me/munhou&apos;</span>]
</code></pre>
<p><span id="__init__.py"></span></p>
<h3 id="initpy"><a name="initpy" class="anchor-navigation-ex-anchor" href="#initpy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="initpy" class="plugin-anchor" href="#initpy"><i class="fa fa-link" aria-hidden="true"></i></a><strong>init</strong>.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-python">

</code></pre>
<p><span id="dataset.py"></span></p>
<h3 id="datasetpy"><a name="datasetpy" class="anchor-navigation-ex-anchor" href="#datasetpy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="datasetpy" class="plugin-anchor" href="#datasetpy"><i class="fa fa-link" aria-hidden="true"></i></a>dataset.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> torch


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dataset_collate_function</span><span class="hljs-params">(batch)</span>:</span>
    feature = torch.stack([torch.tensor([data[<span class="hljs-string">&apos;feature&apos;</span>]]) <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> batch])
    label = torch.tensor([data[<span class="hljs-string">&apos;label&apos;</span>] <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> batch])
    transformed_batch = {
        <span class="hljs-string">&apos;feature&apos;</span>: feature,
        <span class="hljs-string">&apos;label&apos;</span>: label
    }
    <span class="hljs-keyword">return</span> transformed_batch
</code></pre>
<p><span id="metrics.py"></span></p>
<h3 id="metricspy"><a name="metricspy" class="anchor-navigation-ex-anchor" href="#metricspy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="metricspy" class="plugin-anchor" href="#metricspy"><i class="fa fa-link" aria-hidden="true"></i></a>metrics.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">import</span> datasets
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> functional <span class="hljs-keyword">as</span> F
<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader

<span class="hljs-keyword">from</span> ml.dataset <span class="hljs-keyword">import</span> dataset_collate_function


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">confusion_matrix</span><span class="hljs-params">(data_path, model, num_class)</span>:</span>
    data_path = Path(data_path)
    model.eval()

    cm = np.zeros((num_class, num_class), dtype=np.float)

    dataset_dict = datasets.load_dataset(str(data_path.absolute()))
    dataset = dataset_dict[list(dataset_dict.keys())[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">try</span>:
        num_workers = multiprocessing.cpu_count()
    <span class="hljs-keyword">except</span>:
        num_workers = <span class="hljs-number">1</span>
    dataloader = DataLoader(dataset, batch_size=<span class="hljs-number">4096</span>, num_workers=num_workers, collate_fn=dataset_collate_function)
    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> dataloader:
        x = batch[<span class="hljs-string">&apos;feature&apos;</span>].float().to(model.device)
        y = batch[<span class="hljs-string">&apos;label&apos;</span>].long()
        y_hat = torch.argmax(F.log_softmax(model(x), dim=<span class="hljs-number">1</span>), dim=<span class="hljs-number">1</span>)

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(y)):
            cm[y[i], y_hat[i]] += <span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> cm


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_precision</span><span class="hljs-params">(cm, i)</span>:</span>
    tp = cm[i, i]
    tp_fp = cm[:, i].sum()

    <span class="hljs-keyword">return</span> tp / tp_fp


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_recall</span><span class="hljs-params">(cm, i)</span>:</span>
    tp = cm[i, i]
    p = cm[i, :].sum()

    <span class="hljs-keyword">return</span> tp / p


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_classification_report</span><span class="hljs-params">(cm, labels=None)</span>:</span>
    rows = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(cm.shape[<span class="hljs-number">0</span>]):
        precision = get_precision(cm, i)
        recall = get_recall(cm, i)
        <span class="hljs-keyword">if</span> labels:
            label = labels[i]
        <span class="hljs-keyword">else</span>:
            label = i

        row = {
            <span class="hljs-string">&apos;label&apos;</span>: label,
            <span class="hljs-string">&apos;precision&apos;</span>: precision,
            <span class="hljs-string">&apos;recall&apos;</span>: recall
        }
        rows.append(row)

    <span class="hljs-keyword">return</span> pd.DataFrame(rows)
</code></pre>
<p><span id="model.py"></span></p>
<h3 id="modelpy"><a name="modelpy" class="anchor-navigation-ex-anchor" href="#modelpy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="modelpy" class="plugin-anchor" href="#modelpy"><i class="fa fa-link" aria-hidden="true"></i></a>model.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> multiprocessing

<span class="hljs-keyword">import</span> datasets
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> pytorch_lightning <span class="hljs-keyword">import</span> LightningModule
<span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> functional <span class="hljs-keyword">as</span> F
<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader

<span class="hljs-keyword">from</span> ml.dataset <span class="hljs-keyword">import</span> dataset_collate_function


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CNN</span><span class="hljs-params">(LightningModule)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, c1_output_dim, c1_kernel_size, c1_stride, c2_output_dim, c2_kernel_size, c2_stride,
                 output_dim, data_path, signal_length)</span>:</span>
        super().__init__()
        <span class="hljs-comment"># save parameters to checkpoint</span>
        self.save_hyperparameters()

        <span class="hljs-comment"># two convolution, then one max pool</span>
        self.conv1 = nn.Sequential(
            nn.Conv1d(
                in_channels=<span class="hljs-number">1</span>,
                out_channels=self.hparams.c1_output_dim,
                kernel_size=self.hparams.c1_kernel_size,
                stride=self.hparams.c1_stride
            ),
            nn.ReLU()
        )
        self.conv2 = nn.Sequential(
            nn.Conv1d(
                in_channels=self.hparams.c1_output_dim,
                out_channels=self.hparams.c2_output_dim,
                kernel_size=self.hparams.c2_kernel_size,
                stride=self.hparams.c2_stride
            ),
            nn.ReLU()
        )

        self.max_pool = nn.MaxPool1d(
            kernel_size=<span class="hljs-number">2</span>
        )

        <span class="hljs-comment"># flatten, calculate the output size of max pool</span>
        <span class="hljs-comment"># use a dummy input to calculate</span>
        dummy_x = torch.rand(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, self.hparams.signal_length, requires_grad=<span class="hljs-keyword">False</span>)
        dummy_x = self.conv1(dummy_x)
        dummy_x = self.conv2(dummy_x)
        dummy_x = self.max_pool(dummy_x)
        max_pool_out = dummy_x.view(<span class="hljs-number">1</span>, <span class="hljs-number">-1</span>).shape[<span class="hljs-number">1</span>]

        <span class="hljs-comment"># followed by 5 dense layers</span>
        self.fc1 = nn.Sequential(
            nn.Linear(
                in_features=max_pool_out,
                out_features=<span class="hljs-number">200</span>
            ),
            nn.Dropout(p=<span class="hljs-number">0.05</span>),
            nn.ReLU()
        )
        self.fc2 = nn.Sequential(
            nn.Linear(
                in_features=<span class="hljs-number">200</span>,
                out_features=<span class="hljs-number">100</span>
            ),
            nn.Dropout(p=<span class="hljs-number">0.05</span>),
            nn.ReLU()
        )
        self.fc3 = nn.Sequential(
            nn.Linear(
                in_features=<span class="hljs-number">100</span>,
                out_features=<span class="hljs-number">50</span>
            ),
            nn.Dropout(p=<span class="hljs-number">0.05</span>),
            nn.ReLU()
        )

        <span class="hljs-comment"># finally, output layer</span>
        self.out = nn.Linear(
            in_features=<span class="hljs-number">50</span>,
            out_features=self.hparams.output_dim
        )

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self, x)</span>:</span>
        <span class="hljs-comment"># make sure the input is in [batch_size, channel, signal_length]</span>
        <span class="hljs-comment"># where channel is 1</span>
        <span class="hljs-comment"># signal_length is 1500 by default</span>
        batch_size = x.shape[<span class="hljs-number">0</span>]

        <span class="hljs-comment"># 2 conv 1 max</span>
        x = self.conv1(x)
        x = self.conv2(x)
        x = self.max_pool(x)

        x = x.reshape(batch_size, <span class="hljs-number">-1</span>)

        <span class="hljs-comment"># 3 fc</span>
        x = self.fc1(x)
        x = self.fc2(x)
        x = self.fc3(x)

        <span class="hljs-comment"># output</span>
        x = self.out(x)

        <span class="hljs-keyword">return</span> x

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train_dataloader</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># expect to get train folder</span>
        dataset_dict = datasets.load_dataset(self.hparams.data_path)
        dataset = dataset_dict[list(dataset_dict.keys())[<span class="hljs-number">0</span>]]
        <span class="hljs-keyword">try</span>:
            num_workers = multiprocessing.cpu_count()
        <span class="hljs-keyword">except</span>:
            num_workers = <span class="hljs-number">1</span>
        dataloader = DataLoader(dataset, batch_size=<span class="hljs-number">16</span>, num_workers=num_workers, collate_fn=dataset_collate_function,
                                shuffle=<span class="hljs-keyword">True</span>)

        <span class="hljs-keyword">return</span> dataloader

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">configure_optimizers</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> torch.optim.Adam(self.parameters())

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">training_step</span><span class="hljs-params">(self, batch, batch_idx)</span>:</span>
        x = batch[<span class="hljs-string">&apos;feature&apos;</span>].float()
        y = batch[<span class="hljs-string">&apos;label&apos;</span>].long()
        y_hat = self(x)

        entropy = F.cross_entropy(y_hat, y)
        self.log(<span class="hljs-string">&apos;training_loss&apos;</span>, entropy, prog_bar=<span class="hljs-keyword">True</span>, logger=<span class="hljs-keyword">True</span>, on_step=<span class="hljs-keyword">True</span>, on_epoch=<span class="hljs-keyword">True</span>)
        loss = {<span class="hljs-string">&apos;loss&apos;</span>: entropy}

        <span class="hljs-keyword">return</span> loss
</code></pre>
<p><span id="mlutils.py"></span></p>
<h3 id="utilspy"><a name="utilspy" class="anchor-navigation-ex-anchor" href="#utilspy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="utilspy" class="plugin-anchor" href="#utilspy"><i class="fa fa-link" aria-hidden="true"></i></a>utils.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> pytorch_lightning <span class="hljs-keyword">import</span> Trainer
<span class="hljs-keyword">from</span> pytorch_lightning.callbacks <span class="hljs-keyword">import</span> EarlyStopping
<span class="hljs-keyword">from</span> pytorch_lightning.loggers <span class="hljs-keyword">import</span> TensorBoardLogger
<span class="hljs-keyword">from</span> pytorch_lightning.utilities.seed <span class="hljs-keyword">import</span> seed_everything

<span class="hljs-keyword">from</span> ml.model <span class="hljs-keyword">import</span> CNN


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train_cnn</span><span class="hljs-params">(c1_kernel_size, c1_output_dim, c1_stride, c2_kernel_size, c2_output_dim, c2_stride, output_dim, data_path,
              epoch, gpus, model_path, signal_length, logger)</span>:</span>
    <span class="hljs-comment"># prepare dir for model path</span>
    <span class="hljs-keyword">if</span> model_path:
        model_path = Path(model_path)
        model_path.parent.mkdir(parents=<span class="hljs-keyword">True</span>, exist_ok=<span class="hljs-keyword">True</span>)

    <span class="hljs-comment"># seed everything</span>
    seed_everything(seed=<span class="hljs-number">9876</span>, workers=<span class="hljs-keyword">True</span>)

    model = CNN(
        c1_kernel_size=c1_kernel_size,
        c1_output_dim=c1_output_dim,
        c1_stride=c1_stride,
        c2_kernel_size=c2_kernel_size,
        c2_output_dim=c2_output_dim,
        c2_stride=c2_stride,
        output_dim=output_dim,
        data_path=data_path,
        signal_length=signal_length,
    ).float()
    trainer = Trainer(val_check_interval=<span class="hljs-number">1.0</span>, max_epochs=epoch, gpus=gpus, logger=logger,
                      callbacks=[EarlyStopping(monitor=<span class="hljs-string">&apos;training_loss&apos;</span>, mode=<span class="hljs-string">&apos;min&apos;</span>, check_on_train_epoch_end=<span class="hljs-keyword">True</span>)])
    trainer.fit(model)

    <span class="hljs-comment"># save model</span>
    trainer.save_checkpoint(str(model_path.absolute()))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train_application_classification_cnn_model</span><span class="hljs-params">(data_path, model_path, gpu)</span>:</span>
    logger = TensorBoardLogger(<span class="hljs-string">&apos;application_classification_cnn_logs&apos;</span>, <span class="hljs-string">&apos;application_classification_cnn&apos;</span>)
    train_cnn(c1_kernel_size=<span class="hljs-number">4</span>, c1_output_dim=<span class="hljs-number">200</span>, c1_stride=<span class="hljs-number">3</span>, c2_kernel_size=<span class="hljs-number">5</span>, c2_output_dim=<span class="hljs-number">200</span>, c2_stride=<span class="hljs-number">1</span>,
              output_dim=<span class="hljs-number">17</span>, data_path=data_path, epoch=<span class="hljs-number">20</span>, gpus=gpu, model_path=model_path, signal_length=<span class="hljs-number">1500</span>,
              logger=logger)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train_traffic_classification_cnn_model</span><span class="hljs-params">(data_path, model_path, gpu)</span>:</span>
    logger = TensorBoardLogger(<span class="hljs-string">&apos;traffic_classification_cnn_logs&apos;</span>, <span class="hljs-string">&apos;traffic_classification_cnn&apos;</span>)
    train_cnn(c1_kernel_size=<span class="hljs-number">5</span>, c1_output_dim=<span class="hljs-number">200</span>, c1_stride=<span class="hljs-number">3</span>, c2_kernel_size=<span class="hljs-number">4</span>, c2_output_dim=<span class="hljs-number">200</span>, c2_stride=<span class="hljs-number">3</span>,
              output_dim=<span class="hljs-number">12</span>, data_path=data_path, epoch=<span class="hljs-number">20</span>, gpus=gpu, model_path=model_path, signal_length=<span class="hljs-number">1500</span>,
              logger=logger)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_cnn_model</span><span class="hljs-params">(model_path, gpu)</span>:</span>
    <span class="hljs-keyword">if</span> gpu:
        device = <span class="hljs-string">&apos;cuda&apos;</span>
    <span class="hljs-keyword">else</span>:
        device = <span class="hljs-string">&apos;cpu&apos;</span>
    model = CNN.load_from_checkpoint(str(Path(model_path).absolute()), map_location=torch.device(device)).float().to(
        device)

    model.eval()

    <span class="hljs-keyword">return</span> model


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_application_classification_cnn_model</span><span class="hljs-params">(model_path, gpu=False)</span>:</span>
    <span class="hljs-keyword">return</span> load_cnn_model(model_path=model_path, gpu=gpu)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_traffic_classification_cnn_model</span><span class="hljs-params">(model_path, gpu=False)</span>:</span>
    <span class="hljs-keyword">return</span> load_cnn_model(model_path=model_path, gpu=gpu)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">normalise_cm</span><span class="hljs-params">(cm)</span>:</span>
    <span class="hljs-keyword">with</span> np.errstate(all=<span class="hljs-string">&apos;ignore&apos;</span>):
        normalised_cm = cm / cm.sum(axis=<span class="hljs-number">1</span>, keepdims=<span class="hljs-keyword">True</span>)
        normalised_cm = np.nan_to_num(normalised_cm)
        <span class="hljs-keyword">return</span> normalised_cm
</code></pre>
<p><span id=".gitignore"></span></p>
<h3 id="gitignore"><a name="gitignore" class="anchor-navigation-ex-anchor" href="#gitignore"><i class="fa fa-link" aria-hidden="true"></i></a><a name="gitignore" class="plugin-anchor" href="#gitignore"><i class="fa fa-link" aria-hidden="true"></i></a>.gitignore</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-py"><span class="hljs-comment"># Byte-compiled / optimized / DLL files</span>
__pycache__/
*.py[cod]
*$py.<span class="hljs-keyword">class</span>

<span class="hljs-comment"># C extensions</span>
*.so

<span class="hljs-comment"># Distribution / packaging</span>
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
pip-wheel-metadata/
share/python-wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST

<span class="hljs-comment"># PyInstaller</span>
<span class="hljs-comment">#  Usually these files are written by a python script from a template</span>
<span class="hljs-comment">#  before PyInstaller builds the exe, so as to inject date/other infos into it.</span>
*.manifest
*.spec

<span class="hljs-comment"># Installer logs</span>
pip-log.txt
pip-delete-this-directory.txt

<span class="hljs-comment"># Unit test / coverage reports</span>
htmlcov/
.tox/
.nox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover
*.py,cover
.hypothesis/
.pytest_cache/
cover/

<span class="hljs-comment"># Translations</span>
*.mo
*.pot

<span class="hljs-comment"># Django stuff:</span>
*.log
local_settings.py
db.sqlite3
db.sqlite3-journal

<span class="hljs-comment"># Flask stuff:</span>
instance/
.webassets-cache

<span class="hljs-comment"># Scrapy stuff:</span>
.scrapy

<span class="hljs-comment"># Sphinx documentation</span>
docs/_build/

<span class="hljs-comment"># PyBuilder</span>
.pybuilder/
target/

<span class="hljs-comment"># Jupyter Notebook</span>
.ipynb_checkpoints

<span class="hljs-comment"># IPython</span>
profile_default/
ipython_config.py

<span class="hljs-comment"># pyenv</span>
<span class="hljs-comment">#   For a library or package, you might want to ignore these files since the code is</span>
<span class="hljs-comment">#   intended to run in multiple environments; otherwise, check them in:</span>
<span class="hljs-comment"># .python-version</span>

<span class="hljs-comment"># pipenv</span>
<span class="hljs-comment">#   According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.</span>
<span class="hljs-comment">#   However, in case of collaboration, if having platform-specific dependencies or dependencies</span>
<span class="hljs-comment">#   having no cross-platform support, pipenv may install dependencies that don&apos;t work, or not</span>
<span class="hljs-comment">#   install all needed dependencies.</span>
<span class="hljs-comment">#Pipfile.lock</span>

<span class="hljs-comment"># PEP 582; used by e.g. github.com/David-OConnor/pyflow</span>
__pypackages__/

<span class="hljs-comment"># Celery stuff</span>
celerybeat-schedule
celerybeat.pid

<span class="hljs-comment"># SageMath parsed files</span>
*.sage.py

<span class="hljs-comment"># Environments</span>
.env
.venv
env/
venv/
ENV/
env.bak/
venv.bak/

<span class="hljs-comment"># Spyder project settings</span>
.spyderproject
.spyproject

<span class="hljs-comment"># Rope project settings</span>
.ropeproject

<span class="hljs-comment"># mkdocs documentation</span>
/site

<span class="hljs-comment"># mypy</span>
.mypy_cache/
.dmypy.json
dmypy.json

<span class="hljs-comment"># Pyre type checker</span>
.pyre/

<span class="hljs-comment"># pytype static type analyzer</span>
.pytype/

<span class="hljs-comment"># Cython debug symbols</span>
cython_debug/

<span class="hljs-comment"># idea</span>
.idea/

<span class="hljs-comment"># unknown</span>
.DS_Store

<span class="hljs-comment"># data</span>
data/
processed_data/
train_test_data/

<span class="hljs-comment"># model file</span>
model/

<span class="hljs-comment"># logs</span>
lightning_logs/

<span class="hljs-comment"># transfer file</span>
transfer.sh

<span class="hljs-comment"># backup file</span>
*.bak
</code></pre>
<p><span id="create_train_test_set.py"></span></p>
<h3 id="createtraintestsetpy"><a name="createtraintestsetpy" class="anchor-navigation-ex-anchor" href="#createtraintestsetpy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="createtraintestsetpy" class="plugin-anchor" href="#createtraintestsetpy"><i class="fa fa-link" aria-hidden="true"></i></a>create_train_test_set.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-py"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">import</span> click
<span class="hljs-keyword">import</span> psutil
<span class="hljs-keyword">from</span> pyspark.sql <span class="hljs-keyword">import</span> SparkSession, Window
<span class="hljs-keyword">from</span> pyspark.sql.functions <span class="hljs-keyword">import</span> col, monotonically_increasing_id, lit, row_number, rand


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">top_n_per_group</span><span class="hljs-params">(spark_df, groupby, topn)</span>:</span>
    spark_df = spark_df.withColumn(<span class="hljs-string">&apos;rand&apos;</span>, rand(seed=<span class="hljs-number">9876</span>))
    window = Window.partitionBy(col(groupby)).orderBy(col(<span class="hljs-string">&apos;rand&apos;</span>))

    <span class="hljs-keyword">return</span> (
        spark_df
            .select(col(<span class="hljs-string">&apos;*&apos;</span>), row_number().over(window).alias(<span class="hljs-string">&apos;row_number&apos;</span>))
            .where(col(<span class="hljs-string">&apos;row_number&apos;</span>) &lt;= topn)
            .drop(<span class="hljs-string">&apos;row_number&apos;</span>, <span class="hljs-string">&apos;rand&apos;</span>)
    )


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">split_train_test</span><span class="hljs-params">(df, test_size, under_sampling_train=True)</span>:</span>
    <span class="hljs-comment"># add increasing id for df</span>
    df = df.withColumn(<span class="hljs-string">&apos;id&apos;</span>, monotonically_increasing_id())

    <span class="hljs-comment"># stratified split</span>
    fractions = (
        df
            .select(<span class="hljs-string">&apos;label&apos;</span>)
            .distinct().
            withColumn(<span class="hljs-string">&apos;fraction&apos;</span>, lit(test_size))
            .rdd
            .collectAsMap()
    )
    test_id = (
        df
            .sampleBy(<span class="hljs-string">&apos;label&apos;</span>, fractions, seed=<span class="hljs-number">9876</span>)
            .select(<span class="hljs-string">&apos;id&apos;</span>)
            .withColumn(<span class="hljs-string">&apos;is_test&apos;</span>, lit(<span class="hljs-keyword">True</span>))
    )

    df = df.join(test_id, how=<span class="hljs-string">&apos;left&apos;</span>, on=<span class="hljs-string">&apos;id&apos;</span>)

    train_df = (
        df
            .filter(col(<span class="hljs-string">&apos;is_test&apos;</span>).isNull())
            .select(<span class="hljs-string">&apos;feature&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>)
    )
    test_df = (
        df.
            filter(col(<span class="hljs-string">&apos;is_test&apos;</span>))
            .select(<span class="hljs-string">&apos;feature&apos;</span>, <span class="hljs-string">&apos;label&apos;</span>)
    )

    <span class="hljs-comment"># under sampling</span>
    <span class="hljs-keyword">if</span> under_sampling_train:
        <span class="hljs-comment"># get label list with count of each label</span>
        label_count_df = (
            train_df.
                groupby(<span class="hljs-string">&apos;label&apos;</span>)
                .count()
                .toPandas()
        )

        <span class="hljs-comment"># get min label count in train set for under sampling</span>
        min_label_count = int(label_count_df[<span class="hljs-string">&apos;count&apos;</span>].min())

        train_df = top_n_per_group(train_df, <span class="hljs-string">&apos;label&apos;</span>, min_label_count)

    <span class="hljs-keyword">return</span> train_df, test_df


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_parquet</span><span class="hljs-params">(df, path)</span>:</span>
    output_path = path.absolute().as_uri()
    (
        df
            .write
            .mode(<span class="hljs-string">&apos;overwrite&apos;</span>)
            .parquet(output_path)
    )


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_train</span><span class="hljs-params">(df, path_dir)</span>:</span>
    path = path_dir / <span class="hljs-string">&apos;train.parquet&apos;</span>
    save_parquet(df, path)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_test</span><span class="hljs-params">(df, path_dir)</span>:</span>
    path = path_dir / <span class="hljs-string">&apos;test.parquet&apos;</span>
    save_parquet(df, path)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_train_test_for_task</span><span class="hljs-params">(df, label_col, test_size, under_sampling, data_dir_path)</span>:</span>
    task_df = df.filter(col(label_col).isNotNull()).selectExpr(<span class="hljs-string">&apos;feature&apos;</span>, f<span class="hljs-string">&apos;{label_col} as label&apos;</span>)
    print(<span class="hljs-string">&apos;splitting train test&apos;</span>)
    train_df, test_df = split_train_test(task_df, test_size, under_sampling)
    print(<span class="hljs-string">&apos;splitting train test done&apos;</span>)
    print(<span class="hljs-string">&apos;saving train&apos;</span>)
    save_train(train_df, data_dir_path)
    print(<span class="hljs-string">&apos;saving train done&apos;</span>)
    print(<span class="hljs-string">&apos;saving test&apos;</span>)
    save_test(test_df, data_dir_path)
    print(<span class="hljs-string">&apos;saving test done&apos;</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_df_label_distribution</span><span class="hljs-params">(spark, path)</span>:</span>
    print(path)
    print(
        spark
            .read
            .parquet(path.absolute().as_uri())
            .groupby(<span class="hljs-string">&apos;label&apos;</span>).count().toPandas()
    )


<span class="hljs-meta">@click.command()</span>
<span class="hljs-meta">@click.option(&apos;-s&apos;, &apos;--source&apos;, help=&apos;path to the directory containing preprocessed files&apos;, required=True)</span>
<span class="hljs-meta">@click.option(&apos;-t&apos;, &apos;--target&apos;,</span>
              help=<span class="hljs-string">&apos;path to the directory for persisting train and test set for both app and traffic classification&apos;</span>,
              required=<span class="hljs-keyword">True</span>)
<span class="hljs-meta">@click.option(&apos;--test_size&apos;, default=0.2, help=&apos;size of test size&apos;, type=float)</span>
<span class="hljs-meta">@click.option(&apos;--under_sampling&apos;, default=True, help=&apos;under sampling training data&apos;, type=bool)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(source, target, test_size, under_sampling)</span>:</span>
    source_data_dir_path = Path(source)
    target_data_dir_path = Path(target)

    <span class="hljs-comment"># prepare dir for dataset</span>
    application_data_dir_path = target_data_dir_path / <span class="hljs-string">&apos;application_classification&apos;</span>
    traffic_data_dir_path = target_data_dir_path / <span class="hljs-string">&apos;traffic_classification&apos;</span>

    <span class="hljs-comment"># initialise local spark</span>
    os.environ[<span class="hljs-string">&apos;PYSPARK_PYTHON&apos;</span>] = sys.executable
    os.environ[<span class="hljs-string">&apos;PYSPARK_DRIVER_PYTHON&apos;</span>] = sys.executable
    memory_gb = psutil.virtual_memory().available // <span class="hljs-number">1024</span> // <span class="hljs-number">1024</span> // <span class="hljs-number">1024</span>
    spark = (
        SparkSession
            .builder
            .master(<span class="hljs-string">&apos;local[*]&apos;</span>)
            .config(<span class="hljs-string">&apos;spark.driver.memory&apos;</span>, f<span class="hljs-string">&apos;{memory_gb}g&apos;</span>)
            .config(<span class="hljs-string">&apos;spark.driver.host&apos;</span>, <span class="hljs-string">&apos;127.0.0.1&apos;</span>)
            .getOrCreate()
    )

    <span class="hljs-comment"># read data</span>
    df = spark.read.parquet(f<span class="hljs-string">&apos;{source_data_dir_path.absolute().as_uri()}/*.parquet&apos;</span>)

    <span class="hljs-comment"># prepare data for application classification and traffic classification</span>
    print(<span class="hljs-string">&apos;processing application classification dataset&apos;</span>)
    create_train_test_for_task(df=df, label_col=<span class="hljs-string">&apos;app_label&apos;</span>, test_size=test_size, under_sampling=under_sampling,
                               data_dir_path=application_data_dir_path)

    print(<span class="hljs-string">&apos;processing traffic classification dataset&apos;</span>)
    create_train_test_for_task(df=df, label_col=<span class="hljs-string">&apos;traffic_label&apos;</span>, test_size=test_size, under_sampling=under_sampling,
                               data_dir_path=traffic_data_dir_path)

    <span class="hljs-comment"># stats</span>
    print_df_label_distribution(spark, application_data_dir_path / <span class="hljs-string">&apos;train.parquet&apos;</span>)
    print_df_label_distribution(spark, application_data_dir_path / <span class="hljs-string">&apos;test.parquet&apos;</span>)
    print_df_label_distribution(spark, traffic_data_dir_path / <span class="hljs-string">&apos;train.parquet&apos;</span>)
    print_df_label_distribution(spark, traffic_data_dir_path / <span class="hljs-string">&apos;test.parquet&apos;</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:
    main()
</code></pre>
<p><span id="env_linux_cpu.yaml"></span></p>
<h3 id="envlinuxcpuyaml"><a name="envlinuxcpuyaml" class="anchor-navigation-ex-anchor" href="#envlinuxcpuyaml"><i class="fa fa-link" aria-hidden="true"></i></a><a name="envlinuxcpuyaml" class="plugin-anchor" href="#envlinuxcpuyaml"><i class="fa fa-link" aria-hidden="true"></i></a>env_linux_cpu.yaml</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-yaml"><span class="hljs-attr">name:</span> deep_packet

<span class="hljs-attr">channels:</span>
<span class="hljs-bullet">  -</span> defaults
<span class="hljs-bullet">  -</span> plotly
<span class="hljs-bullet">  -</span> pytorch
<span class="hljs-bullet">  -</span> conda-forge
<span class="hljs-attr">dependencies:</span>
<span class="hljs-bullet">  -</span> python=<span class="hljs-number">3.8</span>
<span class="hljs-bullet">  -</span> pip=<span class="hljs-number">21.2</span><span class="hljs-number">.4</span>
<span class="hljs-bullet">  -</span> jupyterlab=<span class="hljs-number">3.2</span><span class="hljs-number">.1</span>
<span class="hljs-bullet">  -</span> scikit-learn=<span class="hljs-number">1.0</span><span class="hljs-number">.2</span>
<span class="hljs-bullet">  -</span> pandas=<span class="hljs-number">1.3</span><span class="hljs-number">.5</span>
<span class="hljs-bullet">  -</span> dask=<span class="hljs-number">2021.10</span><span class="hljs-number">.0</span>
<span class="hljs-bullet">  -</span> pyarrow=<span class="hljs-number">4.0</span><span class="hljs-number">.1</span>
<span class="hljs-bullet">  -</span> seaborn=<span class="hljs-number">0.11</span><span class="hljs-number">.2</span>
<span class="hljs-bullet">  -</span> matplotlib=<span class="hljs-number">3.5</span><span class="hljs-number">.0</span>
<span class="hljs-bullet">  -</span> click=<span class="hljs-number">8.0</span><span class="hljs-number">.3</span>
<span class="hljs-bullet">  -</span> tensorboard=<span class="hljs-number">2.6</span><span class="hljs-number">.0</span>
<span class="hljs-bullet">  -</span> datasets=<span class="hljs-number">1.17</span><span class="hljs-number">.0</span>
<span class="hljs-bullet">  -</span> pyspark=<span class="hljs-number">3.1</span><span class="hljs-number">.2</span>
<span class="hljs-bullet">  -</span> ipywidgets=<span class="hljs-number">7.6</span><span class="hljs-number">.5</span>
<span class="hljs-attr">  - pytorch:</span>:pytorch=<span class="hljs-number">1.10</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  - pytorch:</span>:torchvision=<span class="hljs-number">0.11</span><span class="hljs-number">.2</span>
<span class="hljs-attr">  - pytorch:</span>:torchaudio=<span class="hljs-number">0.10</span><span class="hljs-number">.1</span>
<span class="hljs-attr">  - pytorch:</span>:cpuonly=<span class="hljs-number">2.0</span>
<span class="hljs-attr">  - plotly:</span>:plotly=<span class="hljs-number">5.5</span><span class="hljs-number">.0</span>
<span class="hljs-attr">  - conda-forge:</span>:scapy=<span class="hljs-number">2.4</span><span class="hljs-number">.5</span>
<span class="hljs-attr">  - conda-forge:</span>:pytorch-lightning=<span class="hljs-number">1.5</span><span class="hljs-number">.8</span>
</code></pre>
<p><span id="preprocessing.py"></span></p>
<h3 id="preprocessingpy"><a name="preprocessingpy" class="anchor-navigation-ex-anchor" href="#preprocessingpy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="preprocessingpy" class="plugin-anchor" href="#preprocessingpy"><i class="fa fa-link" aria-hidden="true"></i></a>preprocessing.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-py"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">import</span> click
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> joblib <span class="hljs-keyword">import</span> Parallel, delayed
<span class="hljs-keyword">from</span> scapy.compat <span class="hljs-keyword">import</span> raw
<span class="hljs-keyword">from</span> scapy.layers.inet <span class="hljs-keyword">import</span> IP, UDP
<span class="hljs-keyword">from</span> scapy.layers.l2 <span class="hljs-keyword">import</span> Ether
<span class="hljs-keyword">from</span> scapy.packet <span class="hljs-keyword">import</span> Padding
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> sparse

<span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> should_omit_packet, read_pcap, PREFIX_TO_APP_ID, PREFIX_TO_TRAFFIC_ID


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove_ether_header</span><span class="hljs-params">(packet)</span>:</span>
    <span class="hljs-keyword">if</span> Ether <span class="hljs-keyword">in</span> packet:
        <span class="hljs-keyword">return</span> packet[Ether].payload

    <span class="hljs-keyword">return</span> packet


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mask_ip</span><span class="hljs-params">(packet)</span>:</span>
    <span class="hljs-keyword">if</span> IP <span class="hljs-keyword">in</span> packet:
        packet[IP].src = <span class="hljs-string">&apos;0.0.0.0&apos;</span>
        packet[IP].dst = <span class="hljs-string">&apos;0.0.0.0&apos;</span>

    <span class="hljs-keyword">return</span> packet


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pad_udp</span><span class="hljs-params">(packet)</span>:</span>
    <span class="hljs-keyword">if</span> UDP <span class="hljs-keyword">in</span> packet:
        <span class="hljs-comment"># get layers after udp</span>
        layer_after = packet[UDP].payload.copy()

        <span class="hljs-comment"># build a padding layer</span>
        pad = Padding()
        pad.load = <span class="hljs-string">&apos;\x00&apos;</span> * <span class="hljs-number">12</span>

        layer_before = packet.copy()
        layer_before[UDP].remove_payload()
        packet = layer_before / pad / layer_after

        <span class="hljs-keyword">return</span> packet

    <span class="hljs-keyword">return</span> packet


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">packet_to_sparse_array</span><span class="hljs-params">(packet, max_length=<span class="hljs-number">1500</span>)</span>:</span>
    arr = np.frombuffer(raw(packet), dtype=np.uint8)[<span class="hljs-number">0</span>: max_length] / <span class="hljs-number">255</span>
    <span class="hljs-keyword">if</span> len(arr) &lt; max_length:
        pad_width = max_length - len(arr)
        arr = np.pad(arr, pad_width=(<span class="hljs-number">0</span>, pad_width), constant_values=<span class="hljs-number">0</span>)

    arr = sparse.csr_matrix(arr)
    <span class="hljs-keyword">return</span> arr


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform_packet</span><span class="hljs-params">(packet)</span>:</span>
    <span class="hljs-keyword">if</span> should_omit_packet(packet):
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">None</span>

    packet = remove_ether_header(packet)
    packet = pad_udp(packet)
    packet = mask_ip(packet)

    arr = packet_to_sparse_array(packet)

    <span class="hljs-keyword">return</span> arr


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform_pcap</span><span class="hljs-params">(path, output_path: Path = None, output_batch_size=<span class="hljs-number">10000</span>)</span>:</span>  <span class="hljs-comment"># Path=None&#x4E3A;&#x5141;&#x8BB8;&#x8BE5;&#x9879;&#x4E3A; None&#xFF08;&#x65E0;&#x8F93;&#x5165;&#xFF09;</span>
    <span class="hljs-keyword">if</span> Path(str(output_path.absolute()) + <span class="hljs-string">&apos;_SUCCESS&apos;</span>).exists():  <span class="hljs-comment"># path.absolute()&#x7528;&#x6765;&#x5C55;&#x793A; path &#x8FD9;&#x4E2A;&#x8DEF;&#x5F84;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x8868;&#x793A;</span>
        print(output_path, <span class="hljs-string">&apos;Done&apos;</span>)
        <span class="hljs-keyword">return</span>

    print(<span class="hljs-string">&apos;Processing&apos;</span>, path)

    rows = []
    batch_index = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i, packet <span class="hljs-keyword">in</span> enumerate(read_pcap(path)):
        arr = transform_packet(packet)
        <span class="hljs-keyword">if</span> arr <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">None</span>:
            <span class="hljs-comment"># get labels for app identification</span>
            prefix = path.name.split(<span class="hljs-string">&apos;.&apos;</span>)[<span class="hljs-number">0</span>].lower()
            app_label = PREFIX_TO_APP_ID.get(prefix)
            traffic_label = PREFIX_TO_TRAFFIC_ID.get(prefix)
            row = {
                <span class="hljs-string">&apos;app_label&apos;</span>: app_label,
                <span class="hljs-string">&apos;traffic_label&apos;</span>: traffic_label,
                <span class="hljs-string">&apos;feature&apos;</span>: arr.todense().tolist()[<span class="hljs-number">0</span>]
            }
            rows.append(row)

        <span class="hljs-comment"># write every batch_size packets, by default 10000</span>
        <span class="hljs-keyword">if</span> rows <span class="hljs-keyword">and</span> i &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> i % output_batch_size == <span class="hljs-number">0</span>:
            part_output_path = Path(str(output_path.absolute()) + f<span class="hljs-string">&apos;_part_{batch_index:04d}.parquet&apos;</span>)
            df = pd.DataFrame(rows)
            df.to_parquet(part_output_path)
            batch_index += <span class="hljs-number">1</span>
            rows.clear()

    <span class="hljs-comment"># final write</span>
    <span class="hljs-keyword">if</span> rows:
        df = pd.DataFrame(rows)
        part_output_path = Path(str(output_path.absolute()) + f<span class="hljs-string">&apos;_part_{batch_index:04d}.parquet&apos;</span>)
        df.to_parquet(part_output_path)

    <span class="hljs-comment"># write success file</span>
    <span class="hljs-keyword">with</span> Path(str(output_path.absolute()) + <span class="hljs-string">&apos;_SUCCESS&apos;</span>).open(<span class="hljs-string">&apos;w&apos;</span>) <span class="hljs-keyword">as</span> f:
        f.write(<span class="hljs-string">&apos;&apos;</span>)

    print(output_path, <span class="hljs-string">&apos;Done&apos;</span>)


<span class="hljs-meta">@click.command()</span>
<span class="hljs-meta">@click.option(&apos;-s&apos;, &apos;--source&apos;, help=&apos;path to the directory containing raw pcap files&apos;, required=True)</span>
<span class="hljs-meta">@click.option(&apos;-t&apos;, &apos;--target&apos;, help=&apos;path to the directory for persisting preprocessed files&apos;, required=True)</span>
<span class="hljs-meta">@click.option(&apos;-n&apos;, &apos;--njob&apos;, default=-1, help=&apos;num of executors&apos;, type=int)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(source, target, njob)</span>:</span>
    data_dir_path = Path(source)  <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x539F;&#x6570;&#x636E;&#x5730;&#x5740;</span>
    target_dir_path = Path(target)  <span class="hljs-comment"># &#x8BFB;&#x53D6;&#x76EE;&#x6807;&#x5B58;&#x653E;&#x5730;&#x5740;</span>
    target_dir_path.mkdir(parents=<span class="hljs-keyword">True</span>, exist_ok=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># &#x7ED9;&#x76EE;&#x6807;&#x5B58;&#x653E;&#x5730;&#x5740;&#x63D0;&#x524D;&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5982;&#x679C;&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#x6587;&#x4EF6;&#x5939;&#x4E5F;&#x4E0D;&#x4F1A;&#x62A5;&#x9519;</span>
    <span class="hljs-keyword">if</span> njob == <span class="hljs-number">1</span>:  <span class="hljs-comment"># &#x9488;&#x5BF9;&#x5355;&#x7EBF;&#x7A0B;&#x4E0E;&#x591A;&#x7EBF;&#x7A0B;&#x5206;&#x522B;&#x5904;&#x7406;</span>
        <span class="hljs-keyword">for</span> pcap_path <span class="hljs-keyword">in</span> sorted(data_dir_path.iterdir()):  <span class="hljs-comment"># &#x5C06;&#x539F;&#x6570;&#x636E;&#x5730;&#x5740;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x5B50;&#x6587;&#x4EF6;&#x5939;&#x5730;&#x5740;&#x90FD;&#x5217;&#x51FA;&#x6765;</span>
            transform_pcap(pcap_path, target_dir_path / (pcap_path.name + <span class="hljs-string">&apos;.transformed&apos;</span>))  <span class="hljs-comment"># &#x5C06;&#x8F6C;&#x6362;&#x540E;&#x7684;&#x6570;&#x636E;&#x4ECD;&#x7136;&#x6309;&#x7167;&#x539F;&#x6570;&#x636E;&#x5B50;&#x6587;&#x4EF6;&#x5939;&#x5206;&#x7C7B;&#x5B58;&#x653E;</span>
    <span class="hljs-keyword">else</span>:
        Parallel(n_jobs=njob)(
            delayed(transform_pcap)(pcap_path, target_dir_path / (pcap_path.name + <span class="hljs-string">&apos;.transformed&apos;</span>)) <span class="hljs-keyword">for</span> pcap_path <span class="hljs-keyword">in</span>
            sorted(data_dir_path.iterdir()))


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:
    main()
</code></pre>
<p><span id="train_cnn.py"></span></p>
<h3 id="traincnnpy"><a name="traincnnpy" class="anchor-navigation-ex-anchor" href="#traincnnpy"><i class="fa fa-link" aria-hidden="true"></i></a><a name="traincnnpy" class="plugin-anchor" href="#traincnnpy"><i class="fa fa-link" aria-hidden="true"></i></a>train_cnn.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-py"><span class="hljs-keyword">import</span> click

<span class="hljs-keyword">from</span> ml.utils <span class="hljs-keyword">import</span> train_application_classification_cnn_model, train_traffic_classification_cnn_model


<span class="hljs-meta">@click.command()</span>
<span class="hljs-meta">@click.option(&apos;-d&apos;, &apos;--data_path&apos;, help=&apos;training data dir path containing parquet files&apos;, required=True)</span>
<span class="hljs-meta">@click.option(&apos;-m&apos;, &apos;--model_path&apos;, help=&apos;output model path&apos;, required=True)</span>
<span class="hljs-meta">@click.option(&apos;-t&apos;, &apos;--task&apos;, help=&apos;classification task. Option: &quot;app&quot; or &quot;traffic&quot;&apos;, required=True)</span>
<span class="hljs-meta">@click.option(&apos;--gpu&apos;, help=&apos;whether to use gpu&apos;, default=True, type=bool)</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(data_path, model_path, task, gpu)</span>:</span>
    <span class="hljs-keyword">if</span> gpu:
        gpu = <span class="hljs-number">-1</span>
    <span class="hljs-keyword">else</span>:
        gpu = <span class="hljs-keyword">None</span>
    <span class="hljs-keyword">if</span> task == <span class="hljs-string">&apos;app&apos;</span>:
        train_application_classification_cnn_model(data_path, model_path, gpu)
    <span class="hljs-keyword">elif</span> task == <span class="hljs-string">&apos;traffic&apos;</span>:
        train_traffic_classification_cnn_model(data_path, model_path, gpu)
    <span class="hljs-keyword">else</span>:
        exit(<span class="hljs-string">&apos;Not Support&apos;</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:
    main()
</code></pre>
<p><span id="utils.py"></span></p>
<h3 id="utilspy_1"><a name="utilspy_1" class="anchor-navigation-ex-anchor" href="#utilspy_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="utilspy" class="plugin-anchor" href="#utilspy"><i class="fa fa-link" aria-hidden="true"></i></a>utils.py</h3>
<p>&lt;/span&gt;</p>
<pre><code class="lang-py"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-keyword">from</span> scapy.layers.dns <span class="hljs-keyword">import</span> DNS
<span class="hljs-keyword">from</span> scapy.layers.inet <span class="hljs-keyword">import</span> TCP
<span class="hljs-keyword">from</span> scapy.packet <span class="hljs-keyword">import</span> Padding
<span class="hljs-keyword">from</span> scapy.utils <span class="hljs-keyword">import</span> PcapReader

<span class="hljs-comment"># for app identification</span>
PREFIX_TO_APP_ID = {
    <span class="hljs-comment"># AIM chat</span>
    <span class="hljs-string">&apos;aim_chat_3a&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;aim_chat_3b&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;aimchat1&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;aimchat2&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-comment"># Email</span>
    <span class="hljs-string">&apos;email1a&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&apos;email1b&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&apos;email2a&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&apos;email2b&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-comment"># Facebook</span>
    <span class="hljs-string">&apos;facebook_audio1a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_audio1b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_audio2a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_audio2b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_audio3&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_audio4&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_chat_4a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_chat_4b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_video1a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_video1b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_video2a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebook_video2b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebookchat1&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebookchat2&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;facebookchat3&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-comment"># FTPS</span>
    <span class="hljs-string">&apos;ftps_down_1a&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;ftps_down_1b&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;ftps_up_2a&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;ftps_up_2b&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-comment"># Gmail</span>
    <span class="hljs-string">&apos;gmailchat1&apos;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-string">&apos;gmailchat2&apos;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-string">&apos;gmailchat3&apos;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-comment"># Hangouts</span>
    <span class="hljs-string">&apos;hangout_chat_4b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio1a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio1b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio2a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio2b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio3&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio4&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_chat_4a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_video1b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_video2a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_video2b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-comment"># ICQ</span>
    <span class="hljs-string">&apos;icq_chat_3a&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;icq_chat_3b&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;icqchat1&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;icqchat2&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-comment"># Netflix</span>
    <span class="hljs-string">&apos;netflix1&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;netflix2&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;netflix3&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;netflix4&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-comment"># SCP</span>
    <span class="hljs-string">&apos;scp1&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpdown1&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpdown2&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpdown3&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpdown4&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpdown5&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpdown6&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpup1&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpup2&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpup3&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpup5&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;scpup6&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-comment"># SFTP</span>
    <span class="hljs-string">&apos;sftp1&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;sftp_down_3a&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;sftp_down_3b&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;sftp_up_2a&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;sftp_up_2b&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;sftpdown1&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;sftpdown2&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;sftpup1&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-comment"># Skype</span>
    <span class="hljs-string">&apos;skype_audio1a&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_audio1b&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_audio2a&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_audio2b&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_audio3&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_audio4&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_chat1a&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_chat1b&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file1&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file2&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file3&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file4&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file5&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file6&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file7&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_file8&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_video1a&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_video1b&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_video2a&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-string">&apos;skype_video2b&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-comment"># Spotify</span>
    <span class="hljs-string">&apos;spotify1&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-string">&apos;spotify2&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-string">&apos;spotify3&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-string">&apos;spotify4&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-comment"># Torrent</span>
    <span class="hljs-string">&apos;torrent01&apos;</span>: <span class="hljs-number">12</span>,
    <span class="hljs-comment"># Tor</span>
    <span class="hljs-string">&apos;torfacebook&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;torgoogle&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;tortwitter&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;torvimeo1&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;torvimeo2&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;torvimeo3&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;toryoutube1&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;toryoutube2&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-string">&apos;toryoutube3&apos;</span>: <span class="hljs-number">13</span>,
    <span class="hljs-comment"># Vimeo</span>
    <span class="hljs-string">&apos;vimeo1&apos;</span>: <span class="hljs-number">14</span>,
    <span class="hljs-string">&apos;vimeo2&apos;</span>: <span class="hljs-number">14</span>,
    <span class="hljs-string">&apos;vimeo3&apos;</span>: <span class="hljs-number">14</span>,
    <span class="hljs-string">&apos;vimeo4&apos;</span>: <span class="hljs-number">14</span>,
    <span class="hljs-comment"># Voipbuster</span>
    <span class="hljs-string">&apos;voipbuster1b&apos;</span>: <span class="hljs-number">15</span>,
    <span class="hljs-string">&apos;voipbuster2b&apos;</span>: <span class="hljs-number">15</span>,
    <span class="hljs-string">&apos;voipbuster3b&apos;</span>: <span class="hljs-number">15</span>,
    <span class="hljs-string">&apos;voipbuster_4a&apos;</span>: <span class="hljs-number">15</span>,
    <span class="hljs-string">&apos;voipbuster_4b&apos;</span>: <span class="hljs-number">15</span>,
    <span class="hljs-comment"># Youtube</span>
    <span class="hljs-string">&apos;youtube1&apos;</span>: <span class="hljs-number">16</span>,
    <span class="hljs-string">&apos;youtube2&apos;</span>: <span class="hljs-number">16</span>,
    <span class="hljs-string">&apos;youtube3&apos;</span>: <span class="hljs-number">16</span>,
    <span class="hljs-string">&apos;youtube4&apos;</span>: <span class="hljs-number">16</span>,
    <span class="hljs-string">&apos;youtube5&apos;</span>: <span class="hljs-number">16</span>,
    <span class="hljs-string">&apos;youtube6&apos;</span>: <span class="hljs-number">16</span>,
    <span class="hljs-string">&apos;youtubehtml5_1&apos;</span>: <span class="hljs-number">16</span>,
}

ID_TO_APP = {
    <span class="hljs-number">0</span>: <span class="hljs-string">&apos;AIM Chat&apos;</span>,
    <span class="hljs-number">1</span>: <span class="hljs-string">&apos;Email&apos;</span>,
    <span class="hljs-number">2</span>: <span class="hljs-string">&apos;Facebook&apos;</span>,
    <span class="hljs-number">3</span>: <span class="hljs-string">&apos;FTPS&apos;</span>,
    <span class="hljs-number">4</span>: <span class="hljs-string">&apos;Gmail&apos;</span>,
    <span class="hljs-number">5</span>: <span class="hljs-string">&apos;Hangouts&apos;</span>,
    <span class="hljs-number">6</span>: <span class="hljs-string">&apos;ICQ&apos;</span>,
    <span class="hljs-number">7</span>: <span class="hljs-string">&apos;Netflix&apos;</span>,
    <span class="hljs-number">8</span>: <span class="hljs-string">&apos;SCP&apos;</span>,
    <span class="hljs-number">9</span>: <span class="hljs-string">&apos;SFTP&apos;</span>,
    <span class="hljs-number">10</span>: <span class="hljs-string">&apos;Skype&apos;</span>,
    <span class="hljs-number">11</span>: <span class="hljs-string">&apos;Spotify&apos;</span>,
    <span class="hljs-number">12</span>: <span class="hljs-string">&apos;Torrent&apos;</span>,
    <span class="hljs-number">13</span>: <span class="hljs-string">&apos;Tor&apos;</span>,
    <span class="hljs-number">14</span>: <span class="hljs-string">&apos;Vimeo&apos;</span>,
    <span class="hljs-number">15</span>: <span class="hljs-string">&apos;Voipbuster&apos;</span>,
    <span class="hljs-number">16</span>: <span class="hljs-string">&apos;Youtube&apos;</span>,
}

<span class="hljs-comment"># for traffic identification</span>
PREFIX_TO_TRAFFIC_ID = {
    <span class="hljs-comment"># Chat</span>
    <span class="hljs-string">&apos;aim_chat_3a&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;aim_chat_3b&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;aimchat1&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;aimchat2&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;facebook_chat_4a&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;facebook_chat_4b&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;facebookchat1&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;facebookchat2&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;facebookchat3&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;hangout_chat_4b&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;hangouts_chat_4a&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;icq_chat_3a&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;icq_chat_3b&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;icqchat1&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;icqchat2&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;skype_chat1a&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">&apos;skype_chat1b&apos;</span>: <span class="hljs-number">0</span>,
    <span class="hljs-comment"># Email</span>
    <span class="hljs-string">&apos;email1a&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&apos;email1b&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&apos;email2a&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&apos;email2b&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-comment"># File Transfer</span>
    <span class="hljs-string">&apos;ftps_down_1a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;ftps_down_1b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;ftps_up_2a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;ftps_up_2b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftp1&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftp_down_3a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftp_down_3b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftp_up_2a&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftp_up_2b&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftpdown1&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftpdown2&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;sftpup1&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file1&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file2&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file3&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file4&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file5&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file6&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file7&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">&apos;skype_file8&apos;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-comment"># Streaming</span>
    <span class="hljs-string">&apos;vimeo1&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;vimeo2&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;vimeo3&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;vimeo4&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;youtube1&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;youtube2&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;youtube3&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;youtube4&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;youtube5&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;youtube6&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&apos;youtubehtml5_1&apos;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-comment"># Torrent</span>
    <span class="hljs-string">&apos;torrent01&apos;</span>: <span class="hljs-number">4</span>,
    <span class="hljs-comment"># VoIP</span>
    <span class="hljs-string">&apos;facebook_audio1a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;facebook_audio1b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;facebook_audio2a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;facebook_audio2b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;facebook_audio3&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;facebook_audio4&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio1a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio1b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio2a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio2b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio3&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;hangouts_audio4&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;skype_audio1a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;skype_audio1b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;skype_audio2a&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;skype_audio2b&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;skype_audio3&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-string">&apos;skype_audio4&apos;</span>: <span class="hljs-number">5</span>,
    <span class="hljs-comment"># VPN: Chat</span>
    <span class="hljs-string">&apos;vpn_aim_chat1a&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_aim_chat1b&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_facebook_chat1a&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_facebook_chat1b&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_hangouts_chat1a&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_hangouts_chat1b&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_icq_chat1a&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_icq_chat1b&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_skype_chat1a&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">&apos;vpn_skype_chat1b&apos;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-comment"># VPN: File Transfer</span>
    <span class="hljs-string">&apos;vpn_ftps_a&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;vpn_ftps_b&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;vpn_sftp_a&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;vpn_sftp_b&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;vpn_skype_files1a&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-string">&apos;vpn_skype_files1b&apos;</span>: <span class="hljs-number">7</span>,
    <span class="hljs-comment"># VPN: Email</span>
    <span class="hljs-string">&apos;vpn_email2a&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-string">&apos;vpn_email2b&apos;</span>: <span class="hljs-number">8</span>,
    <span class="hljs-comment"># VPN: Streaming</span>
    <span class="hljs-string">&apos;vpn_vimeo_a&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;vpn_vimeo_b&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-string">&apos;vpn_youtube_a&apos;</span>: <span class="hljs-number">9</span>,
    <span class="hljs-comment"># VPN: Torrent</span>
    <span class="hljs-string">&apos;vpn_bittorrent&apos;</span>: <span class="hljs-number">10</span>,
    <span class="hljs-comment"># VPN VoIP</span>
    <span class="hljs-string">&apos;vpn_facebook_audio2&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-string">&apos;vpn_hangouts_audio1&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-string">&apos;vpn_hangouts_audio2&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-string">&apos;vpn_skype_audio1&apos;</span>: <span class="hljs-number">11</span>,
    <span class="hljs-string">&apos;vpn_skype_audio2&apos;</span>: <span class="hljs-number">11</span>,
}

ID_TO_TRAFFIC = {
    <span class="hljs-number">0</span>: <span class="hljs-string">&apos;Chat&apos;</span>,
    <span class="hljs-number">1</span>: <span class="hljs-string">&apos;Email&apos;</span>,
    <span class="hljs-number">2</span>: <span class="hljs-string">&apos;File Transfer&apos;</span>,
    <span class="hljs-number">3</span>: <span class="hljs-string">&apos;Streaming&apos;</span>,
    <span class="hljs-number">4</span>: <span class="hljs-string">&apos;Torrent&apos;</span>,
    <span class="hljs-number">5</span>: <span class="hljs-string">&apos;Voip&apos;</span>,
    <span class="hljs-number">6</span>: <span class="hljs-string">&apos;VPN: Chat&apos;</span>,
    <span class="hljs-number">7</span>: <span class="hljs-string">&apos;VPN: File Transfer&apos;</span>,
    <span class="hljs-number">8</span>: <span class="hljs-string">&apos;VPN: Email&apos;</span>,
    <span class="hljs-number">9</span>: <span class="hljs-string">&apos;VPN: Streaming&apos;</span>,
    <span class="hljs-number">10</span>: <span class="hljs-string">&apos;VPN: Torrent&apos;</span>,
    <span class="hljs-number">11</span>: <span class="hljs-string">&apos;VPN: Voip&apos;</span>,
}


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_pcap</span><span class="hljs-params">(path: Path)</span>:</span>
    packets = PcapReader(str(path))

    <span class="hljs-keyword">return</span> packets


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">should_omit_packet</span><span class="hljs-params">(packet)</span>:</span>
    <span class="hljs-comment"># SYN, ACK or FIN flags set to 1 and no payload</span>
    <span class="hljs-keyword">if</span> TCP <span class="hljs-keyword">in</span> packet <span class="hljs-keyword">and</span> (packet.flags &amp; <span class="hljs-number">0x13</span>):
        <span class="hljs-comment"># not payload or contains only padding</span>
        layers = packet[TCP].payload.layers()
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> layers <span class="hljs-keyword">or</span> (Padding <span class="hljs-keyword">in</span> layers <span class="hljs-keyword">and</span> len(layers) == <span class="hljs-number">1</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span>

    <span class="hljs-comment"># DNS segment</span>
    <span class="hljs-keyword">if</span> DNS <span class="hljs-keyword">in</span> packet:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span>

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span>
</code></pre>
<footer class="page-footer-ex"> <span class="page-footer-ex-copyright"> <a href="https://github.com/Dante-Su" target="_blank">DanteSU</a> </span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0; <span class="page-footer-ex-footer-update"> <i>updated</i> 2022-05-05 21:22:32 </span> </footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="3.html" class="navigation navigation-prev " aria-label="Previous page: 数据集">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="5.html" class="navigation navigation-next " aria-label="Next page: supplement of DP">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Deep-Packet","level":"1.6.4","depth":2,"next":{"title":"supplement of DP","level":"1.6.5","depth":2,"path":"part5/5.md","ref":"part5/5.md","articles":[]},"previous":{"title":"数据集","level":"1.6.3","depth":2,"path":"part5/3.md","ref":"part5/3.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-lunr","-search","search-pro","splitter","expandable-chapters-small","anchors","github","github-buttons","sharing-plus","anchor-navigation-ex","favicon","copy-code-button","page-footer-ex"],"styles":{"website":"./styles/website.css"},"pluginsConfig":{"github":{"url":"https://github.com/Dante-Su"},"page-footer-ex":{"copyright":"[DanteSU](https://github.com/Dante-Su)","markdown":true,"update_format":"2022-05-05 HH:mm:ss","update_label":"<i>updated</i>"},"splitter":{},"search-pro":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":false},"favicon":{"shortcut":"./source/images/favicon.ico","bookmark":"./source/images/favicon.ico","appleTouch":"./source/images/favicon.ico","appleTouchMore":{"120x120":"./source/images/favicon.ico","180x180":"./source/images/favicon.ico"}},"github-buttons":{},"expandable-chapters-small":{},"copy-code-button":{},"sharing":{"qq":false,"all":["google","facebook","weibo","twitter","qq","qzone","linkedin","pocket"],"douban":false,"facebook":false,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":false,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"DanteSU","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"DanteSU's House","language":"zh-hans","links":{"sidebar":{"但丁世界（在建）":"https://dante-su.github.io/","猪猪之家":"https://github.com/hyffun"}},"gitbook":"3.2.3","description":"All I know is here"},"file":{"path":"part5/4.md","mtime":"2022-05-05T13:22:32.437Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-05-05T13:23:32.269Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

